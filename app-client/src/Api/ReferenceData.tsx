import {
  FormControl,
  MenuItem,
  Select,
  SelectChangeEvent
} from "@mui/material";
import {
  InputLabelWithProblem,
  labelWithProblem
} from "Component/InputLabelWithProblem";
import React from "react";
import { SelectProps } from "@mui/material/Select/Select";
import { AccessType } from "Generated/Raidv2";
import { WithStringKey } from "Util/TypeUtil";

export interface ControlledListItem{
  value: string,
  description: string,
}

export function ListFormControl({ 
  idPrefix, items, label, problem, value, onItemSelect, ...selectProps
}:{
  idPrefix: string, 
  items: ControlledListItem[],
  label: string,
  problem?: string|undefined,
  onItemSelect: (item: ControlledListItem)=>void,
} & SelectProps<string>){
  return <FormControl>
    <InputLabelWithProblem id={idPrefix + "Label"}
      label={label} problem={problem}/>
    <Select {...selectProps}
      id={idPrefix + "Select"}
      labelId={idPrefix + "SelectLabel"}
      label={labelWithProblem(label, problem)}
      error={!!problem}
      value={value || ''}
      onChange={(event: SelectChangeEvent) => {
        const selectedItem = items.find(i => i.value === event.target.value);
        if( selectedItem ){
          onItemSelect(selectedItem);
        }
        else {
          console.error("unable to find item with key", event.target.value);
        }
      }}
    >
      {items.map(i =>
        <MenuItem key={i.value} value={i.value}>{i.description}</MenuItem>
      )}
    </Select>
  </FormControl>
}

export const traditionalKnowledgeLabelSchemeUris: ControlledListItem[] = [
  { value: "", description: "" },
  { value: "https://localcontexts.org/labels/traditional-knowledge-labels/", description: "Traditional Knowledge Labels" },
  { value: "https://localcontexts.org/labels/biocultural-labels/", description: "Biocultural Labels" },
]

export const relatedObjectCategories: ControlledListItem[] = [
  {"value": "", "description": ""},
  {"value": "Input", "description": "Input"},
  {"value": "Output", "description": "Output"},
  {"value": "Internal process document or artefact", "description": "Internal process document or artefact"}
];

export const accessTypes: ControlledListItem[] = [
  {"value": AccessType.Open, "description": "Open"},
  {"value": AccessType.Closed, "description": "Closed"},
];

export function mapAccessType(item: ControlledListItem): AccessType{
  if( item.value === AccessType.Open ){
    return AccessType.Open;
  }
  else if( item.value === AccessType.Closed ){
    return AccessType.Closed;
  }
  else {
    console.error("unknown accessType:", item);
    throw Error("can't map accessType");
  }
}

/* Experimental and untested.
Was going to use this for AccessType select, until I realised that the 
AccessType interface (generated by OpenAPI) is not actually a record - doh!
Keeping it around, because I reckon we'll eventually want a select that 
works with generic objects and I didn't want to lose the work I did on 
the types. */
function ListFormControlRecord<
  TItemType extends Record<TKey, string> & Record<TDescription, string>,
  TKey extends WithStringKey<TItemType>,  
  TDescription extends WithStringKey<TItemType>,  
>({
  idPrefix, label, problem,
  items, valueKey, descriptionKey, onItemSelect, 
  value, 
  ...selectProps
}:{
  idPrefix: string,
  label: string,
  problem: string|undefined,
  items: TItemType[],
  valueKey: TKey
  descriptionKey: TDescription,
  onItemSelect: (value:TItemType)=>void, 
} & SelectProps<string>){
  return <FormControl>
    <InputLabelWithProblem id={idPrefix + "Label"}
      label={label} problem={problem}/>
    <Select {...selectProps}
      id={idPrefix + "Select"}
      labelId={idPrefix + "SelectLabel"}
      label={labelWithProblem(label, problem)}
      error={!!problem}
      value={value || ''}
      onChange={(event: SelectChangeEvent) => {
        const selectedItem = items.find(i=>i[valueKey] === event.target.value);
        if( selectedItem ){
          onItemSelect(selectedItem);
        }
        else {
          console.error("unable to find item with key", event.target.value);
        }
      }}
    >
      {items.map(i =>
        <MenuItem key={i[valueKey]} value={i[descriptionKey]}>
          {i[descriptionKey]}
        </MenuItem>
      )}
    </Select>
  </FormControl>
}

export const relatedRaidTypes: ControlledListItem[] = [
  {"value": "", "description": ""},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/continues.json", "description": "Continues"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/has-part.json", "description": "HasPart"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/is-continued-by.json", "description": "IsContinuedBy"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/is-derived-from.json", "description": "IsDerivedFrom"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/is-identical-to.json", "description": "IsIdenticalTo"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/is-obsoleted-by.json", "description": "IsObsoletedBy"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/is-part-of.json", "description": "IsPartOf"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/is-source-of.json", "description": "IsSourceOf"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-raid/relationship-type/obsoletes.json", "description": "Obsoletes"}
];


export const relatedObjectTypes: ControlledListItem[] = [
  {"value": "", "description": ""},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/audiovisual.json", "description": "Audiovisual"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/book-chapter.json", "description": "Book Chapter"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/book.json", "description": "Book"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/computational-notebook.json", "description": "Computational Notebook"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/conference-paper.json", "description": "Conference Paper"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/conference-poster.json", "description": "Conference Poster"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/conference-proceeding.json", "description": "Conference Proceeding"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/data-paper.json", "description": "Data Paper"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/dataset.json", "description": "Dataset"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/dissertation.json", "description": "Dissertation"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/educational-material.json", "description": "Educational Material"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/event.json", "description": "Event"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/funding.json", "description": "Funding"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/image.json", "description": "Image"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/instrument.json", "description": "Instrument"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/journal-article.json", "description": "Journal Article"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/model.json", "description": "Model"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/output-management-plan.json", "description": "Output Management Plan"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/physical-object.json", "description": "Physical Object"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/preprint.json", "description": "Preprint"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/prize.json", "description": "Prize"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/report.json", "description": "Report"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/service.json", "description": "Service"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/software.json", "description": "Software"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/sound.json", "description": "Sound"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/standard.json", "description": "Standard"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/text.json", "description": "Text"},
  {"value": "https://github.com/au-research/raid-metadata/blob/main/scheme/related-object/related-object-type/workflow.json", "description": "Workflow"}
];

